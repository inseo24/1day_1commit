- 클라우드 네이티브 자바

#### 4. Test

- 클라우드 환경이고 MSA다 보니 주기가 짧은 환경에서도 수행될 수 있어야 함
- 실제 의존 대상 서비스를 연동할 수 없는 빌드나 테스트 환경에서는 모킹해서 테스트
- 모킹도 안 되는 상황이라면 테스트할 때마다 실제 지원 서비스를 프로비저닝 하고 테스트가 종료되면 해당 지원 서비스도 종료되어야 함
    - 모킹이 안되는 상황은 언제일까?
        - 아예 다른 서비스가 개발이 안 된 상태거나…?
    - 여기서 말하는 지원 서비스는 DB, Message Queue, 이메일 서비스 등 애플리케이션이 쓰는 외부 서비스를 말함

- 통합 테스트 : 여러 컴포넌트의 연동을 통합하기 위해 스프링 컨텍스트가 필요함
- 단위 테스트 : 스프링 애플리케이션 컨텐스트에 의존하지 않고 개별 컴포넌트만을 테스트

- 테스트 슬라이스 : 애플리케이션을 구성하는 레이어의 일부만 선택적으로 자동 설정 가능
    - `@JsonTest` : JSON 직렬화/역직렬화 테스트를 위한 설정만을 활성화
    - `@WebMvcTest` : 개별 스프링 MVC 컨트롤러의 테스트를 지원
    - `@DataJpaTest` : 스프링 데이터 JPA 관련 테스트 지원 + 내장 인메모리 DB도 제공
    - `@RestClientTest` : RestTemplate을 사용해 REST 서비스와 통신하는 기능 지원
    
- End-to-End 테스트 : 사용자 관점에서 기능을 테스트 함
    - Eventual Consistency 를 보장할 수 있는 테스트 조건을 설계하는 것이 가장 중요
    - Consumer-Driven Contract Testing : 계약 정의를 기반으로 테스트
        - Spring Cloud Contract
            - 테스트 할 클래스의 메소드 별 Stub을 Groovy 로 생성
            - Stub은 JAR로 패키징되어 배포, 외부에서 API와 동일한 방식으로 요청 가능
            - 변경사항이 생기면 해당 변경이 기존 계약을 준수하는지 여부를 Spring Cloud Contract를 사용해 검증 가능

#### 5. Application Migration

- 컨테이너화된 애플리케이션을 관리할 수 있으나 아래 이유로 권장하지 않는다.
    - 도커 기반 컨테이너는 빌드팩 애플리케이션에 비해 공격받을 위험이 높다. 도커는 사용자가 도커 이미지 내의 루트 파일 시스템의 내용을 지정할 수 있도록 허락하기 때문이다. 빌드팩은 신뢰할 수 있는 루트 파일 시스템 위에서 실행된다.
    - 컨테이너를 만드는 작업은 개발자나 운영자에게 부가적인 일이다.
    - 컨테이너화된 운영체제의 패치나 업데이트를 관리하기 어렵다. 패치나 업데이트를 적용하려면 컨테이너를 새로 만들어야 한다. 중앙에서 쉽게 이미지를 다시 만들고 컨테이너 하나하나를 쉽게 재배포할 수 있는 방법은 없다.
- → ? 배포할 때마다 Docker Build 하고 그 이미지를 AWS ECR에 Push하는디?
    - 클라우드는 권장! 근데 직접 도커 이미지 관리를 하겠다? 그건 권장 노노!! 의 의미인 듯?
